<script type="text/babel">

/* ------------------------------------------------------------------
   Nine-Box Matrix – JS vanilla (no import/export, no TypeScript)
   Reconnaît :
     • Grille 3×3 copiée depuis Excel
     • Liste  « Benefit ⇥ Feas ⇥ Titre »
     • Liste  « ID ⇥ Benefit ⇥ Feas »      (format que tu as montré)
------------------------------------------------------------------ */

const benefitIdx = { High: 0, Medium: 1, Low: 2 };
const feasIdx    = { Low : 0, Medium: 1, High: 2 };

// -------- Parseurs -------------------------------------------------

function parseMatrixFromGrid(raw) {
  const rows = raw.trim().split(/\r?\n/).map(r => r.split(/\t|\s{2,}/).filter(Boolean));
  if (rows.length < 3) return null;
  if (/benefits?/i.test(rows[0][0]) || rows[0][0]==="") rows.shift();   // header row
  if (rows[0].length === 4) rows.forEach(r => r.shift());               // header col
  return Array.from({length:3},(_,i)=>Array.from({length:3},(_,j)=>rows[i]?.[j]||""));
}

function parseMatrixFromList(raw){
  const out = Array.from({length:3},()=>Array(3).fill(""));
  const lines = raw.trim().split(/\r?\n/);

  const hasHeader = /benefit|feas/i.test(lines[0]);
  const data = hasHeader ? lines.slice(1) : lines;

  data.forEach(line=>{
    const parts = line.split(/\t|;/).map(s=>s.trim()).filter(Boolean);
    if(parts.length<3) return;

    // a) Benefit, Feas, Title   |  b) ID, Benefit, Feas
    if(benefitIdx[parts[0]]!==undefined && feasIdx[parts[1]]!==undefined){
      const [b,f,...rest]=parts;
      append(out,b,f,rest.join(" "));
    }else{
      const [id,b,f]=parts;
      append(out,b,f,id);
    }
  });
  return out;
}

function append(mat, b, f, val){
  const r=benefitIdx[b], c=feasIdx[f];
  if(r===undefined||c===undefined||!val) return;
  mat[r][c] = mat[r][c] ? mat[r][c] + "\\n" + val : val;
}

function splitMulti(mat){
  return mat.map(row=>row.map(cell=>
    cell.split(/[,;\\n]+/).map(s=>s.trim()).filter(Boolean).join("\\n")
  ));
}

// -------- Composant React ------------------------------------------

function NineBoxMatrix(){
  const {useState} = React;
  const [matrix,setMatrix] = useState([["","",""],["","",""],["","",""]]);

  function handlePaste(e){
    const txt = e.clipboardData.getData("text/plain");

    const grid = parseMatrixFromGrid(txt);
    if(grid){
      setMatrix(splitMulti(grid));
      e.preventDefault(); return;
    }
    setMatrix(splitMulti(parseMatrixFromList(txt)));
    e.preventDefault();
  }

  const rows = ["High","Medium","Low"];
  const cols = ["Low","Medium","High"];
  const bg = (r,c) => {
    const score=(3-r)+(c+1);
    return score>=6? "bg-green-200" : score>=4? "bg-yellow-200" : "bg-red-200";
  };

  return (
    <div className="p-4 max-w-2xl mx-auto">
      <h1 className="text-xl font-bold mb-2">9-Box Matrix</h1>
      <p className="text-sm mb-4">
        Collez : Grille 3×3 &nbsp;ou&nbsp; Benefit⇥Feas⇥Titre &nbsp;ou&nbsp; ID⇥Benefit⇥Feas
      </p>
      <textarea onPaste={handlePaste}
                placeholder="Ctrl + V ici…"
                className="w-full h-28 p-2 border rounded mb-6"/>
      <div className="grid grid-cols-4 gap-px text-sm">
        <div></div>
        {cols.map(c=><div key={c} className="text-center font-semibold">{c}</div>)}
        {rows.map((rLbl,rIdx)=>([
          <div key={rLbl} className="flex items-center justify-center font-semibold">{rLbl}</div>,
          ...cols.map((_,cIdx)=>
            <div key={cIdx}
                 className={`${bg(rIdx,cIdx)} min-h-[70px] whitespace-pre-wrap p-2 border`}>
              {matrix[rIdx][cIdx]}
            </div>
          )
        ]))}
      </div>
    </div>
  );
}

// -------- Montage dans la page -------------------------------------

ReactDOM.createRoot(document.getElementById('root'))
        .render(<NineBoxMatrix/>);

</script>
